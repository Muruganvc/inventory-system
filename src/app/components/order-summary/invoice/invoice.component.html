<div *ngIf="invoice.items.length > 0" #invoiceContent class="invoice-wrapper">
  <div class="company-bank-row">
    <div class="company-header">
      <h1>{{ invCompanyInfo.inventoryCompanyInfoName }}</h1>
    </div>

    <div class="row-content">
      <div class="company-info">
        <p>{{ invCompanyInfo.description }}</p>
        <div class="contact">
          <p>{{ invCompanyInfo.address }}</p>
          <p>Tel: {{ invCompanyInfo.mobileNo}} | Email: {{ invCompanyInfo.email }}</p>
          <p>GSTIN: {{ invCompanyInfo.gstNumber }}</p>
        </div>
      </div>
      <div class="company-logo">
        <!-- <img [src]="qrCodePreview" alt="Preview" /> -->
        <div class="right-details">
          <p><strong>User:</strong> {{ invoice.user }}</p>
          <p><strong>Invoice No:</strong> {{ invoice.invoiceNo }}</p>
          <p><strong>Invoice Date:</strong> {{ invoice.invoiceDate }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Customer and Invoice Details -->
  <div class="details">
    <div class="left-details">
      <p><strong>Mr./Mrs.:</strong> {{ customer.name }}</p>
      <p><strong>Address:</strong> {{ customer.address }}</p>
      <p><strong>Phone:</strong> {{ customer.phone }}</p>
      <p *ngIf="invoice.isGst"><strong>GST Number:</strong> {{ customer.phone }}</p>
    </div>
    <div class="right-details preview-container">
      <img width="100" height="100" [src]="qrCodePreview" alt="Preview" />
    </div>
  </div>

  <!-- Product Table -->
  <table class="product-table">
    <thead>
      <tr>
        <th>#</th>
        <th>Name of Product(s)</th>
        <th>Serial No</th>
        <th>Qty / Meter</th>
        <th>Rate</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of invoice.items; let i = index">
        <td>{{ i + 1 }}</td>
        <td>{{ item.name }}</td>
        <td>{{ item.serialNo }}</td>
        <td>{{ item.qty }}</td>
        <td class="text-alg">{{ item.rate | currency:'INR':'symbol':'1.2-2' }}</td>
        <td class="text-alg">{{ item.total | currency:'INR':'symbol':'1.2-2' }}</td>
      </tr>
    </tbody>
    <tfoot>
      <tr>
        <td colspan="5"><strong>Sub Total</strong></td>
        <td class="text-alg">
          <strong>{{ getInvoiceTotal(invoice.items) | currency:'INR':'symbol':'1.2-2' }}</strong>
        </td>
      </tr>
    </tfoot>
  </table>

  <!-- Summary (Shown Once) -->
  <div *ngIf="!invoice.isGst" class="invoice-summary" style="page-break-inside: avoid; margin-top: 1rem;">
    <table class="summary-table">

      <!-- Discount % with rowspan + vertical centering -->
      <tr *ngIf="invoice.disCountPercent > 0">
        <td rowspan="2" class="centered-cell"><strong>Discount %:</strong></td>
        <td rowspan="2" class="centered-cell text-alg">{{ invoice.disCountPercent }}%</td>

        <td><strong>Discount Amt:</strong></td>
        <td class="text-alg">
          {{ calculateDiscount(invoice.totalAmount, invoice.disCountPercent) | currency:'INR':'symbol':'1.2-2' }}
        </td>
      </tr>

      <!-- Given Amount row -->
      <tr>
        <td [attr.colspan]="invoice.disCountPercent > 0 ? 1 : 2"><strong>Given Amount:</strong></td>
        <td class="text-alg">
          {{ givenAmount | currency:'INR':'symbol':'1.2-2' }}
        </td>
      </tr>

      <!-- Final Amount -->
      <tr>
        <td *ngIf="invoice.disCountPercent > 0" [attr.colspan]="invoice.disCountPercent > 0 ? 2 : 4"></td>
        <td [attr.colspan]="invoice.disCountPercent > 0 ? 1 : 2"><strong>Grand Amount:</strong></td>
        <td class="text-alg">
          {{
          (invoice.totalAmount - calculateDiscount(invoice.totalAmount, invoice.disCountPercent)) - givenAmount
          | currency:'INR':'symbol':'1.2-2'
          }}
        </td>
      </tr>

    </table>
  </div>
  <div *ngIf="invoice.isGst" class="invoice-summary" style="page-break-inside: avoid; margin-top: 1rem;">
    <table class="summary-table">

      <!-- Discount % with rowspan + vertical centering -->
      <tr>
        <td colspan="3" class="text-alg"><strong>CGST 9%:</strong></td>
        <td class="text-alg">{{calculateGST(invoice.totalAmount,9).gstAmount}}</td>
      </tr>
      <tr>
        <td colspan="3" class="text-alg"><strong>SGST 9%:</strong></td>
        <td class="text-alg">{{calculateGST(invoice.totalAmount,9).gstAmount}}</td>
      </tr>


      <!-- Given Amount row -->
      <tr>
        <td colspan="3" class="text-alg"><strong>Total Amount(include GST):</strong></td>
        <td class="text-alg">
          {{calculateGST(invoice.totalAmount,18).totalAmount}}
        </td>
      </tr>

      <!-- Final Amount -->
      <tr>
        <td colspan="3" class="text-alg"><strong>Given Amount:</strong></td>
        <td class="text-alg">
          {{ givenAmount | currency:'INR':'symbol':'1.2-2'
          }}
        </td>
      </tr>
      <tr>
        <td colspan="3" class="text-alg"><strong>Grand Amount:</strong></td>
        <td class="text-alg">
          {{ (calculateGST(invoice.totalAmount,18).totalAmount) - givenAmount | currency:'INR':'symbol':'1.2-2' }}
        </td>
      </tr>
    </table>
  </div>



  <!-- Amount in Words -->
  <div class="in-words">
    <p><strong>Total in words:</strong> {{ invoice.amountInWords }}</p>
  </div>

  <!-- Bank Details -->
  <div class="bank-section">
    <h3>Bank Details</h3>
    <p><strong>Bank Name:</strong> {{ invCompanyInfo.bankName }}</p>
    <p><strong>Branch Name:</strong> {{ invCompanyInfo.bankBranchName }}</p>
    <p><strong>Bank Account Number:</strong> {{ invCompanyInfo.bankAccountNo }}</p>
    <p><strong>Bank Branch IFSC:</strong> {{ invCompanyInfo.bankBranchIFSC }}</p>
  </div>

  <!-- Signature Block -->
  <div class="signature-block">
    <p>For {{ invCompanyInfo.inventoryCompanyInfoName }}</p>
    <p><em>This is a computer-generated invoice. No signature required.</em></p>
  </div>
</div>