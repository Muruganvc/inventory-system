<form [formGroup]="formGroup">
    <div class="header-row">
        <h2 class="form-title">{{ title }}</h2>

        <div *ngIf="!isMobileView" class="button-group">
            <ng-container *ngFor="let btn of buttons">
                <button type="button" *ngIf="!btn.isHidden" mat-flat-button [disabled]="btn.disabled"
                    [ngClass]="btn.class" (click)="onClick(btn)">
                    <i style="padding: 10px !important;" class="menu-icon" [ngClass]="btn.icon"></i>
                    {{ btn.label }}
                </button>
            </ng-container>
        </div>
    </div>

    <div class="form-grid">
        <ng-container *ngFor="let field of fields">
            <ng-container *ngIf="!field.isHidden">
                <div class="form-field" [ngClass]="'col-span-' + field.colSpan">
                    <ng-container [ngSwitch]="field.type">
                        <!-- Input -->
                        <mat-form-field *ngSwitchCase="'input'" appearance="outline">
                            <mat-label>{{ field.label }}</mat-label>
                            <input matInput [formControlName]="field.name" [readonly]="field.isReadOnly"
                                [attr.maxlength]="field.maxLength || null" appAppSentenceCase />
                            <mat-error *ngIf="formGroup.get(field.name)?.hasError('required')">
                                {{ field.label }} is required
                            </mat-error>
                            <mat-error *ngIf="formGroup.get(field.name)?.hasError('email')">
                                Please enter a valid email
                            </mat-error>
                            <mat-error *ngIf="formGroup.get(field.name)?.hasError('minlength')">
                                Minimum {{ formGroup.get(field.name)?.errors?.['minlength']?.requiredLength }}
                                characters required
                            </mat-error>
                            <mat-error *ngIf="formGroup.get(field.name)?.hasError('pattern')">
                                Invalid {{ field.label }}
                            </mat-error>
                        </mat-form-field>

                        <!-- Password -->
                        <mat-form-field *ngSwitchCase="'password'" appearance="outline">
                            <mat-label>{{ field.label }}</mat-label>
                            <input matInput type="password" [formControlName]="field.name" />
                        </mat-form-field>

                        <!-- Searchable Select -->
                        <!-- <ng-container *ngSwitchCase="'searchable-select'">
                            <div class="ng-select-wrapper">
                                <ng-select [formControlName]="field.name" [items]="field.options" bindLabel="key"
                                    [class.ng-invalid]="formGroup.get(field.name)?.invalid"
                                    [class.ng-touched]="formGroup.get(field.name)?.touched"
                                    [addTag]="field.addTag"
                                    (add)="field.add"
                                    (clear)="field.clear"
                                    placeholder="Select {{ field.label }}"></ng-select>
                                <div class="mat-error force-error-style"
                                    *ngIf="formGroup.get(field.name)?.touched && formGroup.get(field.name)?.hasError('required')">
                                    {{ field.label }} is required
                                </div>
                            </div>
                        </ng-container> -->
                        <!-- <ng-container *ngSwitchCase="'searchable-select'">
                            <div class="ng-select-wrapper">
                                <ng-select [formControlName]="field.name" [items]="field.options" bindLabel="key"
                                    bindValue="value" [addTag]="field.addTag ? field.add : false"
                                    (add)="field.add && field.add($event)" (clear)="field.clear && field.clear()"
                                    [class.ng-invalid]="formGroup.get(field.name)?.invalid"
                                    [class.ng-touched]="formGroup.get(field.name)?.touched"
                                    placeholder="Select {{ field.label }}">
                                </ng-select>

                                <div class="mat-error force-error-style"
                                    *ngIf="formGroup.get(field.name)?.touched && formGroup.get(field.name)?.hasError('required')">
                                    {{ field.label }} is required
                                </div>
                            </div>
                        </ng-container> -->


                        <!-- <ng-container *ngSwitchCase="'searchable-select'">
                            <div class="ng-select-wrapper">
                                <ng-select [formControlName]="field.name" [items]="field.options" bindLabel="key" [addTag]="field.addTag"
                                    (add)="field.add($event)" (clear)="field.clear && field.clear()"
                                    placeholder="Select {{ field.label }}" [class.ng-invalid]="formGroup.get(field.name)?.invalid"
                                    [class.ng-touched]="formGroup.get(field.name)?.touched"></ng-select>
                        
                                <div class="mat-error force-error-style"
                                    *ngIf="formGroup.get(field.name)?.touched && formGroup.get(field.name)?.hasError('required')">
                                    {{ field.label }} is required
                                </div>
                            </div>
                        </ng-container> -->


                        <ng-container *ngSwitchCase="'searchable-select'">
                            <div class="ng-select-wrapper">
                                <ng-select [formControlName]="field.name" [items]="field.options" bindLabel="key"
                                    [addTag]="field.addTag" 
                                    (clear)="field.clear?.()"
                                    placeholder="Select {{ field.label }}"
                                    [class.ng-invalid]="formGroup.get(field.name)?.invalid"
                                    [class.ng-touched]="formGroup.get(field.name)?.touched">
                                </ng-select>

                                <div class="mat-error force-error-style"
                                    *ngIf="formGroup.get(field.name)?.touched && formGroup.get(field.name)?.hasError('required')">
                                    {{ field.label }} is required
                                </div>
                            </div>
                        </ng-container>

                        <!-- Select -->
                        <mat-form-field *ngSwitchCase="'select'" appearance="outline">
                            <mat-label>{{ field.label }}</mat-label>
                            <mat-select [formControlName]="field.name">
                                <mat-option *ngFor="let opt of field.options" [value]="opt.value">{{ opt.label
                                    }}</mat-option>
                            </mat-select>
                        </mat-form-field>

                        <!-- Date Picker -->
                        <mat-form-field *ngSwitchCase="'date'" appearance="outline">
                            <mat-label>{{ field.label }}</mat-label>
                            <input matInput [matDatepicker]="picker" [formControlName]="field.name" />
                            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                        </mat-form-field>

                        <!-- Checkbox -->
                        <div *ngSwitchCase="'checkbox'" class="form-control-wrapper">
                            <label class="form-label">{{ field.label }}</label>
                            <mat-checkbox [formControlName]="field.name"></mat-checkbox>
                        </div>

                        <!-- Radio Group -->
                        <div *ngSwitchCase="'radio'" class="form-control-wrapper">
                            <label class="form-label">{{ field.label }}</label>
                            <mat-radio-group [formControlName]="field.name">
                                <mat-radio-button *ngFor="let opt of field.options" [value]="opt.value">{{ opt.label
                                    }}</mat-radio-button>
                            </mat-radio-group>
                        </div>

                        <!-- Toggle -->
                        <div *ngSwitchCase="'toggle'" class="form-control-wrapper">
                            <label class="form-label">{{ field.label }}</label>
                            <mat-slide-toggle [formControlName]="field.name"></mat-slide-toggle>
                        </div>

                        <!-- Textarea -->
                        <mat-form-field *ngSwitchCase="'textarea'" appearance="outline" color="accent">
                            <mat-label>{{ field.label }}</mat-label>
                            <textarea matInput [formControlName]="field.name" [readonly]="field.isReadOnly"
                                [attr.maxlength]="field.maxLength || null" [rows]="field.rows || 4"
                                [placeholder]="field.placeholder || ''" class="no-resize" appAppSentenceCase></textarea>
                        </mat-form-field>

                    </ng-container>
                </div>
            </ng-container>
        </ng-container>
    </div>

    <!-- Button Group -->
    <div *ngIf="isMobileView" class="button-group">
        <ng-container *ngFor="let btn of buttons">
            <button type="button" *ngIf="!btn.isHidden" mat-flat-button [disabled]="btn.disabled" [ngClass]="btn.class"
                (click)="onClick(btn)">
                <i style="padding: 10px !important;" class="menu-icon" [ngClass]="btn.icon"></i>
                {{ btn.label }}
            </button>
        </ng-container>
    </div>
</form>